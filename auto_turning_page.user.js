// ==UserScript==
// @name        LANraragi - Auto turning page
// @namespace   https://github.com/AwesomeVodka/LANraragi-Auto-turrning-page
// @include     *:*/reader?id=*
// @grant       unsafeWindow
// @version     0.1.3
// @author      AwesomeVodka
// @description Script to add auto turning page function to LANraragi Reader.
// @license     MIT
// @homepageURL https://github.com/AwesomeVodka/LANraragi-Auto-turrning-page
// @supportURL  https://github.com/AwesomeVodka/LANraragi-Auto-turrning-page/issues
// @downloadURL https://awesomevodka.github.io/LANraragi-Auto-turrning-page/auto_turning_page.user.js
// @updateURL   https://awesomevodka.github.io/LANraragi-Auto-turrning-page/auto_turning_page.user.js
// @run-at      document-idle
// ==/UserScript==

(function() {
    'use strict';

    if("undefined" !== typeof Reader) {
        const ATP_START_BTN_ICON_CLASSNAME = "fa fa-circle-play fa-2x";
        const ATP_STOP_BTN_ICON_CLASSNAME = "fa fa-circle-stop fa-2x";
        const ATP_INPS_STOP_BTN_ID = "atp-inps-stop-btn"
        const ATP_INPS_STOP_BTN_SHOW_VALUE = "inline-block";
        const ATP_INPS_STOP_BTN_HIDE_VALUE = "none";
        const ATP_INPS_STOP_BTN_STYLES = [
            "display: " + ATP_INPS_STOP_BTN_HIDE_VALUE,
            "position: fixed",
            "top: 10px",
            "right: 10px",
            "padding: 10px 20px",
            "color: rgb(255,255,255,255,0.5)",
            "border: none",
            "border-radius: 5px",
            "cursor: pointer"
        ];
        const ATP_WAKELOCK_VIDEO_DATA_URL = "data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAEDptZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2NCByMzEwOCAzMWUxOWY5IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTIgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTEga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9MzAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAGmWIhAD//B+Fi0CmW4i4ok+Rlj8arX8HwpeBAAAACEGaJGxP//7A3gIATGF2YzYwLjMxLjEwMgBCIAjBGDgAAAAHQZ5CeK/ggSEQBGCMHCEQBGCMHAAAAAgBnmF0Sf/igCEQBGCMHCEQBGCMHAAAAAcBnmNEn+KBIRAEYIwcAAAACUGaaDSkwT/+wSEQBGCMHCEQBGCMHAAAAAlBnoZF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AQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAACgAAAAABAAAEAAAAAAEAAAAAAAAAAQAAAgAAAAABAAAKAAAAAAEAAAQAAAAAAQAAAAAAAAABAAACAAAAAAEAAAoAAAAAAQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAACgAAAAABAAAEAAAAAAEAAAAAAAAAAQAAAgAAAAABAAAKAAAAAAEAAAQAAAAAAQAAAAAAAAABAAACAAAAAAEAAAoAAAAAAQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAACgAAAAABAAAEAAAAAAEAAAAAAAAAAQAAAgAAAAABAAAKAAAAAAEAAAQAAAAAAQAAAAAAAAABAAACAAAAAAEAAAoAAAAAAQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAACgAAAAABAAAEAAAAAAEAAAAAAAAAAQAAAgAAAAABAAAKAAAAAAEAAAQAAAAAAQAAAAAAAAABAAACAAAAAAEAAAoAAAAAAQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAACgAAAAABAAAEAAAAAAEAAAAAAAAAAQAAAgAAAAABAAAKAAAAAAEAAAQAAAAAAQAAAAAAAAABAAACAAAAAAEAAAoAAAAAAQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAACgAAAAABAAAEAAAAAAEAAAAAAAAAAQAAAgAAAAABAAAKAAAAAAEAAAQAAAAAAQAAAAAAAAABAAACAAAAAAEAAAoAAAAAAQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAACgAAAAABAAAEAAAAAAEAAAAAAAAAAQAAAgAAAAABAAAKAAAAAAEAAAQAAAAAAQAAAAAAAAABAAACAAAAAAEAAAoAAAAAAQAABAAAAAABAAAAAAAAAAEAAAIAAAAAAQAABAAAAAAoc3RzYwAAAAAAAAACAAAAAQAAAAIAAAABAAAAAgAAAAEAAAABAAACjHN0c3oAAAAAAAAAAAAAAJ4AAALQAAAADAAAAAsAAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAA0AAAAMAAAACwAAAA0AAAANAAAADAAAAAsAAAANAAAADQAAAAwAAAALAAAADQAAAoRzdGNvAAAAAAAAAJ0AAAAwAAADIwAAAzoAAANSAAADYwAAA3wAAAOPAAADpwAAA7gAAAPRAAAD6gAAA/wAAAQTAAAEJgAABD8AAARRAAAEaAAABHsAAASUAAAErAAABL0AAATWAAAE6QAABQEAAAUSAAAFKwAABUQAAAVWAAAFbQAABYAAAAWZAAAFqwAABcIAAAXVAAAF7gAABgYAAAYXAAAGMAAABkMAAAZbAAAGbAAABoUAAAaeAAAGsAAABscAAAbaAAAG8wAABwUAAAccAAAHLwAAB0gAAAdgAAAHcQAAB4oAAAedAAAHtQAAB8YAAAffAAAH+AAACAoAAAghAAAINAAACE0AAAhfAAAIdgAACIkAAAiiAAAIugAACMsAAAjkAAAI9wAACQ8AAAkgAAAJOQAACVIAAAlkAAAJewAACY4AAAmnAAAJuQAACdAAAAnjAAAJ/AAAChQAAAolAAAKPgAAClEAAAppAAAKegAACpMAAAqsAAAKvgAACtUAAAroAAALAQAACxMAAAsqAAAL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"
        const ATP_SETTING_IS_KEY = "atp_is";
        const ATP_SETTING_IS_DEFAULT = 8;
        const ATP_SETTING_IS_MIN = 1;
        const ATP_SETTING_IS_MAX = 60;
        const ATP_SETTING_USEFS_KEY = "atp_usefs";
        const ATP_SETTING_USEFS_ID_PREFIX = "atp-setting-usefs-";
        const ATP_SETTING_USEFS_ENABLED = "enabled";
        const ATP_SETTING_USEFS_DISABLED = "disabled";
        const LANRARAGI_FS_EL_ID = "i3";
        const LANRARAGI_BTN_TOGGLED_CLASSNAME = "toggled";

        const methods = {
            getValidSiVal: function(timerVal) {
                let returnVal = timerVal;

                if(!returnVal) {
                    returnVal = unsafeWindow.localStorage.getItem(ATP_SETTING_IS_KEY);
                }

                returnVal = parseInt(returnVal);

                if(Number.isNaN(returnVal) || returnVal < ATP_SETTING_IS_MIN || returnVal > ATP_SETTING_IS_MAX) {
                    returnVal = ATP_SETTING_IS_DEFAULT;
                }

                return returnVal;
            },
            getValidUsefsVal: function(usefullscreenVal) {
                let returnVal = usefullscreenVal;

                if(!returnVal) {
                    returnVal = unsafeWindow.localStorage.getItem(ATP_SETTING_USEFS_KEY);
                }

                if(ATP_SETTING_USEFS_ENABLED !== returnVal && ATP_SETTING_USEFS_DISABLED !== returnVal) {
                    returnVal = ATP_SETTING_USEFS_ENABLED;
                }

                return returnVal;
            },
            checkUsefs: function() {
                return (ATP_SETTING_USEFS_ENABLED === methods.getValidUsefsVal());
            },
            isFullscreenMode: function() {
                let $fullscreenEl = document.fullscreenElement;
                
                return ($fullscreenEl && LANRARAGI_FS_EL_ID === $fullscreenEl.id);
            },
            switchWakeLock: function(on) {
                if(true == on) {
                    $wakeLockVideoEl.play();
                } else {
                    $wakeLockVideoEl.pause();
                }
            },
            atpStart: function() {
                let setTimer = methods.getValidSiVal();

                if(methods.checkUsefs() && !methods.isFullscreenMode()) {
                    Reader.handleFullScreen(true);
                }

                atpRunBtnElArr.forEach(function($el) {
                    $el.className = ATP_STOP_BTN_ICON_CLASSNAME;
                });

                methods.switchWakeLock(true);

                atpInst = setInterval(function() {
                    if(Reader.maxPage === Reader.currentPage) {
                        methods.atpStop();
                    } else {
                        Reader.changePage(1);
                    }
                }, setTimer * 1000);
            },
            atpStop: function() {
                if(methods.checkUsefs() && methods.isFullscreenMode()) {
                    document.exitFullscreen();
                }

                atpRunBtnElArr.forEach(function($el) {
                    $el.className = ATP_START_BTN_ICON_CLASSNAME;
                });

                methods.switchWakeLock(false);

                clearInterval(atpInst);
            }
        }

        const eventlistener = {
            atpRunBtnClick: function(e) {
                e.stopPropagation();

                if(Reader.currentPageLoaded) {
                    if(!atpRun) {
                        methods.atpStart();
                    } else if(atpRun) {
                        methods.atpStop();
                    }

                    atpRun = !atpRun
                }
            },
            atpSettingSiChange: function(e) {
                if(Reader.currentPageLoaded) {
                    let inputVal = parseInt(e.currentTarget.value);
                    let validVal = methods.getValidSiVal(inputVal);

                    if(validVal !== inputVal) {
                        e.currentTarget.value = validVal;
                    }

                    unsafeWindow.localStorage.setItem(ATP_SETTING_IS_KEY, validVal);
                }
            },
            atpSettingFullscreenBtnClick: function(e) {
                if(Reader.currentPageLoaded) {
                    let inputVal = methods.getValidUsefsVal(e.currentTarget.value);

                    if(ATP_SETTING_USEFS_ENABLED === inputVal) {
                        $usefsSettingEnabledBtnEl.classList.add(LANRARAGI_BTN_TOGGLED_CLASSNAME);
                        $usefsSettingDisabledBtnEl.classList.remove(LANRARAGI_BTN_TOGGLED_CLASSNAME);
                    } else {
                        $usefsSettingEnabledBtnEl.classList.remove(LANRARAGI_BTN_TOGGLED_CLASSNAME);
                        $usefsSettingDisabledBtnEl.classList.add(LANRARAGI_BTN_TOGGLED_CLASSNAME);
                    }

                    unsafeWindow.localStorage.setItem(ATP_SETTING_USEFS_KEY, inputVal);
                }
            },
            fullscreenChange: function(e) {
                if(Reader.currentPageLoaded) {
                    if(methods.isFullscreenMode()) {
                        $fullscreenInStopBtnEl.style.display = ATP_INPS_STOP_BTN_SHOW_VALUE;
                    } else {
                        $fullscreenInStopBtnEl.style.display = ATP_INPS_STOP_BTN_HIDE_VALUE;
                    }
                }
            }
        };

        let atpInst = -1;
        let atpRun = false;
        let atpRunBtnElArr = [];
        let $atpRunBtnEl = document.createElement("a");
            $atpRunBtnEl.className = ATP_START_BTN_ICON_CLASSNAME;

        let $siSettingEl = document.createElement("div");
            $siSettingEl.id = "atp-setting-si";

        let $siSettingTitleEl = document.createElement("h2");
            $siSettingTitleEl.className = "config-panel";
            $siSettingTitleEl.innerText = "Auto turning page - Seconds interval";

        let $siSettingDescEl = document.createElement("span");
            $siSettingDescEl.className = "config-panel";
            $siSettingDescEl.innerText = "Set the seconds interval to auto turning the page.\r\n(Default 8 sec, Min 1 sec, Max 60 sec)\r\n* If you enter a value out of range or a non-numeric value, it will be set to the default value.";

        let $siSettingInputEl = document.createElement("input");
            $siSettingInputEl.className = "stdinput";
            $siSettingInputEl.id = "atp-setting-si-input";
            $siSettingInputEl.type = "number";
            $siSettingInputEl.min = ATP_SETTING_IS_MIN;
            $siSettingInputEl.max = ATP_SETTING_IS_MAX;
            $siSettingInputEl.value = methods.getValidSiVal();
            $siSettingInputEl.onchange = eventlistener.atpSettingSiChange;

        $siSettingEl.append($siSettingTitleEl);
        $siSettingEl.append($siSettingDescEl);
        $siSettingEl.append($siSettingInputEl);

        let $usefsSettingEl = document.createElement("div");
            $usefsSettingEl.id = "atp-setting-usefs";

        let $usefsSettingTitleEl = document.createElement("h2");
            $usefsSettingTitleEl.className = "config-panel";
            $usefsSettingTitleEl.innerText = "Auto turning page - Use fullscreen";

        let $usefsSettingDescEl = document.createElement("span");
            $usefsSettingDescEl.className = "config-panel";
            $usefsSettingDescEl.innerText = "Set whether to use fullscreen mode when auto turning page to run.\r\n(default \"enabled\")\r\n* If an invalid value is entered, it will be set to the default value.";

        let $usefsSettingEnabledBtnEl = document.createElement("input");
            $usefsSettingEnabledBtnEl.className = "favtag-btn config-btn";
            $usefsSettingEnabledBtnEl.id = ATP_SETTING_USEFS_ID_PREFIX + ATP_SETTING_USEFS_ENABLED;
            $usefsSettingEnabledBtnEl.type = "button";
            $usefsSettingEnabledBtnEl.value = ATP_SETTING_USEFS_ENABLED;
            $usefsSettingEnabledBtnEl.innerText = "Enabled";
            $usefsSettingEnabledBtnEl.onclick = eventlistener.atpSettingFullscreenBtnClick;

        let $usefsSettingDisabledBtnEl = $usefsSettingEnabledBtnEl.cloneNode(false);
            $usefsSettingDisabledBtnEl.id = ATP_SETTING_USEFS_ID_PREFIX + ATP_SETTING_USEFS_DISABLED;
            $usefsSettingDisabledBtnEl.value = ATP_SETTING_USEFS_DISABLED;
            $usefsSettingDisabledBtnEl.innerText = "Disabled";
            $usefsSettingDisabledBtnEl.onclick = eventlistener.atpSettingFullscreenBtnClick;

        if(ATP_SETTING_USEFS_ENABLED === methods.getValidUsefsVal()) {
            $usefsSettingEnabledBtnEl.classList.add(LANRARAGI_BTN_TOGGLED_CLASSNAME);
        } else {
            $usefsSettingDisabledBtnEl.classList.add(LANRARAGI_BTN_TOGGLED_CLASSNAME);
        }

        $usefsSettingEl.append($usefsSettingTitleEl);
        $usefsSettingEl.append($usefsSettingDescEl);
        $usefsSettingEl.append($usefsSettingEnabledBtnEl);
        $usefsSettingEl.append($usefsSettingDisabledBtnEl);

        // 풀스크린 모드에서 표시할 버튼
        let $runBtnCloneEl = $atpRunBtnEl.cloneNode(false);
            $runBtnCloneEl.style.cssText = ATP_INPS_STOP_BTN_STYLES.join(";");
            $runBtnCloneEl.id = ATP_INPS_STOP_BTN_ID;
            $runBtnCloneEl.onclick = eventlistener.atpRunBtnClick;

            document.querySelector("div#i3").append($runBtnCloneEl);

            atpRunBtnElArr.push($runBtnCloneEl);

        let $fullscreenInStopBtnEl = $runBtnCloneEl;

        document.querySelectorAll("div.absolute-options.absolute-right").forEach(function($rightMenuEl) {
            $runBtnCloneEl = $atpRunBtnEl.cloneNode(false);
            $runBtnCloneEl.onclick = eventlistener.atpRunBtnClick;

            $rightMenuEl.prepend($runBtnCloneEl);

            atpRunBtnElArr.push($runBtnCloneEl);
        });

        // 화면 꺼짐 방지를 위한 video 태그 추가
        let $wakeLockVideoEl = document.createElement("video");
            $wakeLockVideoEl.src = ATP_WAKELOCK_VIDEO_DATA_URL;
            $wakeLockVideoEl.loop = true;
            $wakeLockVideoEl.muted = true;
            $wakeLockVideoEl.style.display="none";

        document.querySelector("div#i3").append($wakeLockVideoEl);
        document.querySelector("div#settingsOverlay").append($siSettingEl);
        document.querySelector("div#settingsOverlay").append($usefsSettingEl);

        document.addEventListener("fullscreenchange", eventlistener.fullscreenChange);
    }
})();